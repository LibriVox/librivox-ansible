<VirtualHost 127.0.0.1:8081>

    ServerName librivox.org

    DocumentRoot /librivox/www/catalog.librivox.org/public_html

    <Directory /librivox/www/catalog.librivox.org/public_html>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride None
        Require all granted
        RewriteEngine On
        RewriteBase /
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ index.php?/$1 [L]
    </Directory>

    ProxyPassMatch \
    ^/(.*\.php(/.*)?)$ \
    fcgi://127.0.0.1:9000/librivox/www/catalog.librivox.org/public_html/$1

    # Uploads is on its own subdomain without Varnish in front
    RedirectMatch permanent /uploads(.*)$ http://uploads.librivox.org$1

    # Old /newcatalog URL needs to be redirected
    RedirectMatch permanent ^/newcatalog/?$ http://librivox.org/search

    # Old /forum URL needs to be redirected
    RedirectMatch permanent /forum(.*)$ https://forum.librivox.org$1

    # Redirect reader pages
    RewriteEngine on
    RewriteCond %{REQUEST_URI} ^/newcatalog/people_public.php$
    RewriteCond %{QUERY_STRING} peopleid=(.+)
    RewriteRule ^.*$ http://librivox.org/reader/%1?

</VirtualHost>
