<VirtualHost {{ catalog_blog_ip }}:443>

    ServerName librivox.org

    SSLEngine On
    SSLCertificateFile /librivox/tls/STAR_librivox_org.crt
    SSLCertificateKeyFile /librivox/tls/STAR_librivox_org.key
    SSLCACertificateFile /librivox/tls/STAR_librivox_org.ca-bundle

    Alias /librivox-validator-books /librivox/shared/librivox-validator-books
    ProxyPass /librivox-validator-books !
    <Directory /librivox/shared/librivox-validator-books>
        Options Indexes
        AllowOverride None
        Require all granted
    </Directory>

    Alias /uploads /librivox/shared/uploads/uploads
    ProxyPass /uploads !
    <Directory /librivox/shared/uploads>
        Options Indexes
        AllowOverride None
        Require all granted
    </Directory>
    
    # Wordpress URLs
    ProxyPassMatch "^/$"                        "http://127.0.0.1:8080"
    ProxyPassMatch "^/([0-9]{4}/[0-9]{2}.*)$"   "http://127.0.0.1:8080/$1"
    ProxyPassMatch "^/(author/[a-zA-Z]+/?.*)$"  "http://127.0.0.1:8080/$1"
    ProxyPassMatch "^/(category.*)$"            "http://127.0.0.1:8080/$1"
    ProxyPassMatch "^/(feed/?.*)$"              "http://127.0.0.1:8080/$1"
    ProxyPassMatch "^/(donate-to-librivox.*)$"  "http://127.0.0.1:8080/$1"
    ProxyPassMatch "^/(pages.*)$"               "http://127.0.0.1:8080/$1"
    ProxyPassMatch "^/(podcast.xml.*)$"         "http://127.0.0.1:8080/$1"
    ProxyPassMatch "^/(wp-.*)$"                 "http://127.0.0.1:8080/$1"

    # Everything else to the catalog
    ProxyPass "/" "http://127.0.0.1:8081/"

    ProxyPreserveHost On

</VirtualHost>

<VirtualHost {{ catalog_blog_ip }}:80>

    Redirect / https://librivox.org/

</VirtualHost>
